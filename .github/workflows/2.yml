name: Cyberdropâ€†/â€†Bunkr ä¸‹è½½å¹¶ä¸Šä¼  OneDrive

on:
  workflow_dispatch:
    inputs:
      target_url:
        description: 'Cyberdrop.meã€Bunkr.sk ç­‰ç›¸å†Œæˆ–æ–‡ä»¶ URL'
        required: true
      dest_dir:
        description: 'ä¸Šä¼ åˆ° od: ä¸‹çš„å­ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰ï¼Œå¦‚ MyAlbum'
        required: true

jobs:
  download_and_upload:
    runs-on: ubuntu-latest   # macOS ä¹Ÿè¡Œï¼Œæ”¹æˆ macos-latest å³å¯

    steps:

      # 2. å®‰è£… Python (â‰¥3.10)
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      # 3. å…‹éš†å¹¶å®‰è£… CyberdropBunkrDownloader
      - name: Install Cyberdrop/Bunkr Downloader
        run: |
          git clone https://github.com/PaaaulZ/CyberdropBunkrDownloader.git
          pip install --upgrade pip
          pip install -r CyberdropBunkrDownloader/requirements.txt

      # 4. æ‰§è¡Œä¸‹è½½åˆ° ./downloads
      - name: Download target URL
        run: |
          python CyberdropBunkrDownloader/dump.py \
            -u "${{ github.event.inputs.target_url }}" \
            -p downloads

      # 5. å®‰è£…å¹¶åŠ è½½ Rcloneï¼ˆçº¯æ–‡æœ¬ configï¼‰
      - name: Setup Rclone (plain config)
        uses: AnimMouse/setup-rclone@v1
        with:
          rclone_config: ${{ secrets.RCLONE_CONFIG }}
          disable_base64: true   # å‘Šè¯‰ actionï¼šè¿™æ˜¯çº¯æ–‡æœ¬ï¼Œè€Œä¸æ˜¯ base64

      # 6. ä¸Šä¼ åˆ° OneDrive
      - name: Upload to OneDrive
        run: |
          echo "ğŸ“ æºç›®å½•  = downloads/"
          echo "ğŸ“ ç›®æ ‡ç›®å½• = od:${{ github.event.inputs.dest_dir }}"
          rclone copy downloads/ "od:${{ github.event.inputs.dest_dir }}" \
            --transfers 32 --checkers 32 --fast-list \
            --multi-thread-streams 8 --multi-thread-cutoff 16M \
            --buffer-size 1G --drive-chunk-size 256M \
            --onedrive-chunk-size 60M --progress --stats 1s

      # 7. æ¸…ç†
      - name: Cleanup
        run: rm -rf downloads
