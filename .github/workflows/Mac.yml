name: é«˜é€Ÿ Rclone æ–‡ä»¶æ¬è¿ï¼ˆmacOS Runnerï¼‰

on:
  workflow_dispatch:
    inputs:
      path:
        description: 'new: ä¸‹è¦æ¬è¿çš„å­ç›®å½•åï¼Œå¯å¸¦æˆ–ä¸å¸¦æ–œæ ï¼ˆå¦‚ myFolder æˆ– myFolder/ï¼‰'
        required: true

jobs:
  transfer:
    runs-on: macos-latest

    steps:
      - name: Checkout ä»£ç 
        uses: actions/checkout@v3

      - name: å®‰è£…å¹¶åŠ è½½ Rcloneï¼ˆçº¯æ–‡æœ¬ configï¼‰
        uses: AnimMouse/setup-rclone@v1
        with:
          rclone_config: ${{ secrets.RCLONE_CONFIG }}
          disable_base64: true

      - name: "é«˜é€Ÿæ‹·è´å¹¶åˆ›å»ºåŒåå­æ–‡ä»¶å¤¹ `${{ github.event.inputs.path }}`"
        run: |
          # å–è¾“å…¥ï¼Œå»é™¤å‰åæ–œæ ï¼Œå¾—åˆ°è§„èŒƒåŒ–è·¯å¾„
          RAW="${{ github.event.inputs.path }}"
          SRC="${RAW#/}"       # å»æ‰å‰å¯¼æ–œæ ï¼ˆå¦‚æœæœ‰ï¼‰
          SRC="${SRC%/}"       # å»æ‰å°¾éƒ¨æ–œæ ï¼ˆå¦‚æœæœ‰ï¼‰
          echo "ğŸ“ æºç›®å½• = new:${SRC}"
          echo "ğŸ“ ç›®æ ‡ç›®å½• = od:${SRC}"
          
          # æŠŠ new:SRC å¤åˆ¶åˆ° od:SRCï¼Œod:SRC ä¸å­˜åœ¨æ—¶ä¼šè‡ªåŠ¨åˆ›å»º
          rclone copy \
            "new:${SRC}" \
            "od:${SRC}" \
            --transfers=32 \
            --checkers=32 \
            --fast-list \
            --multi-thread-streams=8 \
            --multi-thread-cutoff=16M \
            --buffer-size=1G \
            --drive-chunk-size=256M \
            --onedrive-chunk-size=60M \   # å¿…é¡»æ˜¯ 320KiB çš„æ•´æ•°å€ :contentReference[oaicite:0]{index=0}
            --progress \
            --stats=1s
      
