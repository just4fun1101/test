name: Bunkr ä¸‹è½½å¹¶ä¸Šä¼ åˆ° OneDrive

on:
  workflow_dispatch:
    inputs:
      bunkr_url:
        description: 'è¦ä¸‹è½½çš„ Bunkr ä¸“è¾‘æˆ–æ–‡ä»¶ URL'
        required: true
      dest_dir:
        description: 'ä¸Šä¼ åˆ° od: ä¸‹çš„ç›®æ ‡å­ç›®å½•ï¼ˆä¼šè‡ªåŠ¨åˆ›å»ºï¼‰ï¼Œä¾‹å¦‚ï¼šMyAlbum'
        required: true

jobs:
  bunkr_to_rclone:
    runs-on: macos-latest

    steps:
      - name: Checkout ä»£ç 
        uses: actions/checkout@v3

      - name: å…‹éš† BunkrDownloader å¹¶å®‰è£…ä¾èµ–
        run: |
          git clone https://github.com/Lysagxra/BunkrDownloader.git
          cd BunkrDownloader
          python3 -m pip install --upgrade pip
          pip install -r requirements.txt
        # BunkrDownloader æ˜¯ä¸€ä¸ª Python è„šæœ¬ï¼Œç”¨äºå¹¶å‘ä¸‹è½½ Bunkr ä¸“è¾‘æˆ–å•ä¸ªæ–‡ä»¶çš„åª’ä½“å†…å®¹:contentReference[oaicite:0]{index=0}

      - name: æ‰§è¡Œ Bunkr ä¸‹è½½
        working-directory: BunkrDownloader
        run: |
          python3 downloader.py "${{ github.event.inputs.bunkr_url }}" --disable-ui
        # ä¸‹è½½ç»“æœå­˜æ”¾åœ¨ BunkrDownloader/Downloads/ ç›®å½•ä¸‹

      - name: å®‰è£…å¹¶åŠ è½½ Rcloneï¼ˆçº¯æ–‡æœ¬ configï¼‰
        uses: AnimMouse/setup-rclone@v1
        with:
          rclone_config: ${{ secrets.RCLONE_CONFIG }}
          disable_base64: true

      - name: ä¸Šä¼  Downloads/ åˆ° od:${{ github.event.inputs.dest_dir }}
        run: |
          echo "ğŸ“ æºç›®å½• = BunkrDownloader/Downloads/"
          echo "ğŸ“ ç›®æ ‡ç›®å½• = od:${{ github.event.inputs.dest_dir }}"
          rclone copy \
            "BunkrDownloader/Downloads/" \
            "od:${{ github.event.inputs.dest_dir }}" \
            --transfers=32 \
            --checkers=32 \
            --fast-list \
            --multi-thread-streams=8 \
            --multi-thread-cutoff=16M \
            --buffer-size=1G \
            --drive-chunk-size=256M \
            --onedrive-chunk-size=60M \
            --progress \
            --stats=1s
        # ä½¿ç”¨é«˜å¹¶å‘ä¸åˆ†ç‰‡å‚æ•°ï¼Œå…¨é€Ÿä¸Šä¼ åˆ° OneDrive :contentReference[oaicite:1]{index=1}
        # å¦‚æœ Rclone é…ç½®æ–‡ä»¶æœ‰åŠ å¯†ï¼Œå–æ¶ˆä¸‹é¢ä¸¤è¡Œæ³¨é‡Šå¯ç”¨å¯†ç è§£å¯†ï¼š
        # env:
        #   RCLONE_CONFIG_PASS: ${{ secrets.RCLONE_CONFIG_PASS }}
