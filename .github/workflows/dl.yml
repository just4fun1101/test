name: sxyprn ä¸‹è½½å¹¶ä¸Šä¼ è‡³ OneDrive lil vids

on:
  workflow_dispatch:
    inputs:
      sxyprn_url:
        description: 'è¦ä¸‹è½½çš„ SxyPrn è§†é¢‘æˆ–ä¸“è¾‘é“¾æ¥'
        required: true
      dest_dir:
        description: 'ä¸Šä¼ è‡³ od çš„ç›®æ ‡å­ç›®å½•ï¼ˆé»˜è®¤ä¸º lil vidsï¼‰'
        required: false
        default: 'lil vids'

jobs:
  download_and_upload:
    runs-on: ubuntu-latest
    steps:
      # 1. æ‹‰å–ä»“åº“ä»£ç ï¼ˆå¯é€‰ï¼Œå¦‚æœä»…ä½¿ç”¨è„šæœ¬å¯çœç•¥ï¼‰
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. å®‰è£… Python åŠ yt-dlp
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'
      - name: Install yt-dlp
        run: |
          python -m pip install --upgrade pip
          pip install yt-dlp

      # 3. å®‰è£… uncensored æ’ä»¶
      - name: Install yt-dlp-uncensored-plugin
        run: |
          # åˆ›å»ºæ’ä»¶ç›®å½•
          mkdir -p ~/.config/yt-dlp/plugins
          # å…‹éš†æ’ä»¶ä»“åº“åˆ°æŒ‡å®šä½ç½®
          git clone https://github.com/mirkul-yeah/yt-dlp-uncensored-plugin.git ~/.config/yt-dlp/plugins/yt-dlp-uncensored-plugin

      # 4. ä½¿ç”¨ yt-dlp ä¸‹è½½ SxyPrn å†…å®¹
      - name: Download from SxyPrn
        run: |
          # æŒ‡å®šä¸‹è½½ç›®å½•
          DOWNLOAD_DIR=downloads
          mkdir -p "$DOWNLOAD_DIR"
          # è°ƒç”¨ yt-dlpï¼Œè‡ªåŠ¨åŠ è½½æ’ä»¶
          yt-dlp -o "${DOWNLOAD_DIR}/%(title)s.%(ext)s" "${{ github.event.inputs.sxyprn_url }}"

      # 5. å®‰è£…å¹¶é…ç½® rclone
      - name: Install and configure Rclone
        uses: AnimMouse/setup-rclone@v1
        with:
          rclone_config: ${{ secrets.RCLONE_CONFIG }}
          disable_base64: true

      # 6. ä¸Šä¼ åˆ° OneDrive çš„ lil vids ç›®å½•
      - name: Upload to OneDrive
        run: |
          SRC="./downloads"
          DST="od:${{ github.event.inputs.dest_dir }}"
          echo "ğŸ“ æºç›®å½• = $SRC"
          echo "ğŸ“ ç›®æ ‡ç›®å½• = $DST"
          rclone copy \
            "$SRC" \
            "$DST" \
            --transfers=16 \
            --checkers=16 \
            --fast-list \
            --progress
